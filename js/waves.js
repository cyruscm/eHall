function init(){initRenderer(),initNodes(),requestAnimationFrame(loop)}function initRenderer(){mRenderer=new Renderer("#canvas"),mScene=new Node}function initNodes(){var t=new Node(new Sky(width,height,"#ffcbbb","#ffe2c0"));mScene.add(t);var i,e;e=new Node(new Island(randomRange(width/10,width/3),randomRange(height/7,height/5),0|randomRange(3,6),"#ffcab0","#a38286")),e.x=randomRange(width/3,width/1.5),e.y=randomRange(height/1.5,height/1.7),mScene.add(e),i=new Node(new Wave(width,height,25,"#FFEDCF","#7680A7")),i.y=height/1.7,mScene.add(i),e=new Node(new Island(randomRange(width/8,width/4),randomRange(height/6,height/4),0|randomRange(2,4),"#ffcab0","#a38286")),e.x=randomRange(0,width/3),e.y=randomRange(height/1.4,height/1.6),mScene.add(e),i=new Node(new Wave(width,height,25,"#FFDFCC","#7680A7")),i.y=height/1.6,mScene.add(i),e=new Node(new Island(randomRange(width/7,width/3),randomRange(height/9,width/5),0|randomRange(2,4),"#ffcab0","#a38286")),e.x=randomRange(width/2,width),e.y=randomRange(height/1.3,height/1.5),mScene.add(e),i=new Node(new Wave(width,height,8,"#FFE4CD","#7680A7")),i.y=height/1.5,mScene.add(i),initRays(i);var h=new Node(new Sun(40,300,"#ffefcb"));h.x=400,h.y=100,mScene.add(h)}function initRays(t){for(var i,e,h,n,a=16,r=width/a,s=0;a>s;s++)e=randomRange(width/10,width/5),h=12*e,n=Math.PI*randomRange(.2,.8),i=new Node(new Ray(e,h,n)),i.x=s*r+randomRange(-40,40),i.y=-50,i.rotation=Math.PI*-.06,t.add(i)}function draw(){mRenderer.ctx.shadowColor="rgba(255,239,203,0.5)",mRenderer.ctx.shadowBlur=64,mRenderer.render(mScene)}function loop(){draw(),requestAnimationFrame(loop)}function Wave(t,i,e,h,n){this.verts=[],this.time=Math.random()*Math.PI,this.speed=1/60;for(var a=t/e,r=0,s=0,d=10,o=0;e>=o;o++)r=0===o||o===e?0:randomRange(-d,d),s=randomRange(-d,d),this.verts.push([a*o+r,s]);this.verts.push([t,i],[0,i]),this.fill=mRenderer.ctx.createLinearGradient(0,0,0,i),this.fill.addColorStop(0,h),this.fill.addColorStop(1,n)}function Ray(t,i,e){this.width=t,this.height=i,this.angle=e,this.time=Math.random()*Math.PI,this.speed=1/60;var h=Math.cos(this.angle)*this.height,n=Math.sin(this.angle)*this.height;this.fill=mRenderer.ctx.createLinearGradient(0,0,h,n),this.fill.addColorStop(0,"rgba(255, 255, 255, 0.040)"),this.fill.addColorStop(.3,"rgba(255, 255, 255, 0.025)"),this.fill.addColorStop(1,"rgba(255, 255, 255, 0.0)")}function Sky(t,i,e,h){this.width=t,this.height=i,this.fill=mRenderer.ctx.createLinearGradient(0,0,0,i),this.fill.addColorStop(0,e),this.fill.addColorStop(1,h)}function Island(t,i,e,h,n){function a(e){return[Math.cos(e)*t,Math.sin(e)*i]}var r=Math.PI;this.verts=[],this.verts.push(a(r));for(var s=0;e>s;s++)r+=Math.PI/e*randomRange(.5,1),this.verts.push(a(r));this.verts.push(a(0)),this.fill=mRenderer.ctx.createLinearGradient(0,-i,0,0),this.fill.addColorStop(0,h),this.fill.addColorStop(1,n)}function Sun(t,i,e){this.innerRadius=t,this.outerRadius=i,this.color1=e,this.gradient=mRenderer.ctx.createRadialGradient(0,0,0,0,0,i),this.gradient.addColorStop(0,"rgba(255,255,255,0.2)"),this.gradient.addColorStop(1,"rgba(255,255,255,0.0)")}function Renderer(t,i,e){this.canvas=document.querySelector(t),this.ctx=this.canvas.getContext("2d"),this.viewWidth=this.canvas.width=i||this.canvas.clientWidth,this.viewHeight=this.canvas.height=e||this.canvas.clientHeight}function Node(t){this.graphics=t,this.x=0,this.y=0,this.pivotX=0,this.pivotY=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.children=[]}function randomRange(t,i){return t+Math.random()*(i-t)}var mRenderer,mScene,height=$(window).height(),width=$(window).width();window.onload=init,Wave.prototype={draw:function(t){this.time+=this.speed,t.beginPath(),t.fillStyle=this.fill;for(var i=0;i<this.verts.length-2;i++)t.lineTo(this.verts[i][0],this.verts[i][1]+8*Math.sin(this.time+i));t.lineTo.apply(t,this.verts[this.verts.length-2]),t.lineTo.apply(t,this.verts[this.verts.length-1]),t.closePath(),t.fill(),t.clip()}},Ray.prototype={draw:function(t){this.time+=this.speed;var i=10*Math.sin(this.time);t.globalCompositeOperation="lighter",t.fillStyle=this.fill,t.fillRect(i,0,this.width,this.height)}},Sky.prototype={draw:function(t){t.fillStyle=this.fill,t.fillRect(0,0,this.width,this.height)}},Island.prototype={draw:function(t){t.beginPath(),t.fillStyle=this.fill;for(var i=0;i<this.verts.length;i++)t.lineTo.apply(t,this.verts[i]);t.closePath(),t.fill()}},Sun.prototype={draw:function(t){t.fillStyle=this.gradient,t.globalCompositeOperation="lighter",t.beginPath(),t.arc(0,0,this.outerRadius,0,Math.TWO_PI),t.fill(),t.fillStyle=this.color1,t.beginPath(),t.arc(0,0,this.innerRadius,0,Math.TWO_PI),t.fill()}},Renderer.prototype={render:function(t){this.ctx.clearRect(0,0,this.viewWidth,this.viewHeight),t.render(this.ctx)}},Node.prototype={add:function(t){this.children.push(t)},remove:function(t){var i=this.children.indexOf(t);i>=0&&this.children.splice(i,1)},render:function(t){t.save(),t.translate(this.pivotX+this.x,this.pivotY+this.y),t.rotate(this.rotation),t.scale(this.scaleX,this.scaleY),t.translate(-this.pivotX,-this.pivotY),this.graphics&&this.graphics.draw(t);for(var i=0;i<this.children.length;i++)this.children[i].render(t);t.restore()}},Math.TWO_PI=2*Math.PI;